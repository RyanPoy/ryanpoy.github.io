<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="来
  搜狐后，这里做的系统几乎都是 webpy &#43; twsited 写的。所以，有必要好好学习一下这两个东西了。从今天开始介绍webpy。">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="/posts/a-user-guild-to-using-webpy/">
  <meta property="og:site_name" content="一哥黑板报">
  <meta property="og:title" content="webpy教程">
  <meta property="og:description" content="来 搜狐后，这里做的系统几乎都是 webpy &#43; twsited 写的。所以，有必要好好学习一下这两个东西了。从今天开始介绍webpy。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2011-08-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-16T17:44:43+08:00">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Webpy">
<title>webpy教程 | 一哥黑板报</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="/posts/a-user-guild-to-using-webpy/">
<link rel="stylesheet" href="/book.min.e47103a2785905b5db8438d6a609c05371af6c90eabdc369de60b296f8bba830.css" >
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.1b54163ba33699d30ae95ade6aca3c1aab77db8407ee0eb2bed501765f3a8acb.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.jpeg" alt="Logo" class="book-icon" /><span>一哥黑板报</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>























  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/RyanPoy/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>webpy教程</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#server">Server</a></li>
        <li><a href="#template">Template</a></li>
        <li><a href="#数据库操作">数据库操作</a>
          <ul>
            <li><a href="#cgi配置">cgi配置</a></li>
            <li><a href="#性能测试">性能测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    webpy教程
  </h1>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/svg/calendar.svg" class="book-icon " alt="" />
    <span>August 18, 2011</span>
  </div>



  
  <div class="text-small">
    
      <a href="/categories/Tutorials/">Tutorials</a>
  </div>
  

  
  <div class="text-small">
    
      <a href="/tags/Python/">Python</a>, 
      <a href="/tags/Webpy/">Webpy</a>
  </div>
  


  <div class="book-post-content"><p>来
  <a href="https://sohu.com">搜狐</a>后，这里做的系统几乎都是 webpy + twsited 写的。所以，有必要好好学习一下这两个东西了。从今天开始介绍webpy。</p>
<h2 id="server">
  Server
  <a class="anchor" href="#server">#</a>
</h2>
<p><strong>安装</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo pip install web.py
</span></span></code></pre></div><p><strong>第一个demo</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#coding: utf-8    </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urls <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;Index&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Index</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Hello, world ! GET </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">POST</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Hello, world ! POST </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start</span>():
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    start()
</span></span></code></pre></div><p><strong>启动</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>python webpy_test.py 0.0.0.0:4321
</span></span></code></pre></div><p><strong>GET 测试</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt;&gt;&gt; curl http://localhost:4321
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Hello, world ! GET
</span></span></code></pre></div><p><strong>POST 测试</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt;&gt;&gt; curl http://localhost:4321 -d<span style="color:#e6db74">&#39;t=1&#39;</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Hello, world ! POST
</span></span></code></pre></div><p><strong>总结</strong></p>
<ol>
<li>url 简单的就是字符串，和django很类似</li>
<li>对于Controller而言，get请求执行GET方法，post请求执行POST方法，估计PUT和DELETE等也是一样的</li>
</ol>
<h2 id="template">
  Template
  <a class="anchor" href="#template">#</a>
</h2>
<p>公司直接用的jinja。jinja和django template的太相似了。说说如果在webpy中使用jinja。</p>
<p><strong>webpy_jinja.py</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#coding: utf-8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> web
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> web.contrib.template <span style="color:#f92672">import</span> render_jinja
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urls <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;hello&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>render <span style="color:#f92672">=</span> render_jinja(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;templates&#39;</span>,           <span style="color:#75715e"># 模板位置.</span>
</span></span><span style="display:flex;"><span>    encoding <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;utf-8&#39;</span>,    <span style="color:#75715e"># 编码.</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hello</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render<span style="color:#f92672">.</span>hello(value<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;hello, World! GET&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">POST</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> web<span style="color:#f92672">.</span>seeother(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run()
</span></span></code></pre></div><p><strong>hello.html</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{value}}
</span></span></code></pre></div><p><strong>跳转</strong></p>
<ul>
<li>Hello 的 GET 请求就是直接的服务器渲染页面，发送给客户端(一般是browser)</li>
<li>Hello 的 POST 就是服务器端返回给客户端http code，然后客户端直接进行跳转，再次跳转到Hello的GET上</li>
</ul>
<h2 id="数据库操作">
  数据库操作
  <a class="anchor" href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c">#</a>
</h2>
<p><strong>得到连接</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>database(dbn<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;postgres&#39;</span>, db<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mydata&#39;</span>, user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dbuser&#39;</span>, pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span></code></pre></div><p><strong>简单查询</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db<span style="color:#f92672">.</span>select(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;table_name&#39;</span>,                   <span style="color:#75715e"># 表名</span>
</span></span><span style="display:flex;"><span>    vars  <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;name&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;py&#39;</span>},          <span style="color:#75715e"># 用来填充查询条件, 这个例子中对应的就是where的$name</span>
</span></span><span style="display:flex;"><span>    where <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;username=$name&#39;</span>,       <span style="color:#75715e"># 查询条件</span>
</span></span><span style="display:flex;"><span>    what  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;id, username&#39;</span>,         <span style="color:#75715e"># 表示你要查询的field是哪些，默认为*。这个例子中表示查询id和username字段</span>
</span></span><span style="display:flex;"><span>    order <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;age DESC&#39;</span>,             <span style="color:#75715e"># 排序方式，表示按照年龄的倒排</span>
</span></span><span style="display:flex;"><span>    group <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;gender&#39;</span>,               <span style="color:#75715e"># 表示按照gender分组</span>
</span></span><span style="display:flex;"><span>    limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,                     <span style="color:#75715e"># 查询10条</span>
</span></span><span style="display:flex;"><span>    offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,                    <span style="color:#75715e"># 表示从第10条开始</span>
</span></span><span style="display:flex;"><span>    _test  <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span><span style="color:#f92672">/</span><span style="color:#66d9ef">False</span>             <span style="color:#75715e"># 日志打印出查询语句，True表示打印，False表示不打印。一般debug环境设置为True</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p><strong>高级查询</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;SELECT COUNT(*) AS total_users FROM users&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 有sql注入，可以修改为下面的</span>
</span></span><span style="display:flex;"><span>db<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;SELECT * FROM user WHERE user.id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 没有sql注入</span>
</span></span><span style="display:flex;"><span>db<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;SELECT * FROM user WHERE user.id = $id&#34;</span>, vars <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">10</span> }) 
</span></span></code></pre></div><p><strong>更新</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 把id=10的记录的username修改为pengyi</span>
</span></span><span style="display:flex;"><span>db<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#39;table_name&#39;</span>, where<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;id = 10&#34;</span>, username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pengyi&#34;</span>) 
</span></span></code></pre></div><p><strong>插入</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db<span style="color:#f92672">.</span>insert(<span style="color:#e6db74">&#39;table_name&#39;</span>, username<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Poy&#34;</span>) <span style="color:#75715e"># 插入一条记录，设置username=Poy</span>
</span></span></code></pre></div><p><strong>删除</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>db<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">&#39;table_name&#39;</span>, where<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;id = 10&#34;</span>) <span style="color:#75715e"># 删除id=10的记录</span>
</span></span></code></pre></div><p><strong>事务</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> db<span style="color:#f92672">.</span>transaction():
</span></span><span style="display:flex;"><span>    db<span style="color:#f92672">.</span>insert(<span style="color:#e6db74">&#39;table_name&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;py&#39;</span>)
</span></span><span style="display:flex;"><span>    db<span style="color:#f92672">.</span>insert(<span style="color:#e6db74">&#39;table_name&#39;</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pengyi&#39;</span>)
</span></span></code></pre></div><p>部署就不用说太多。直接fastcgi</p>
<h3 id="cgi配置">
  cgi配置
  <a class="anchor" href="#cgi%e9%85%8d%e7%bd%ae">#</a>
</h3>
<p><strong>安装flug</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo pip install flup
</span></span></code></pre></div><p><strong>webpy启动代码中写</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run_cgi</span>(func, addr):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> flups<span style="color:#f92672">.</span>WSGIServer(func, multiplexed<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, bindAddress<span style="color:#f92672">=</span>addr)<span style="color:#f92672">.</span>run()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_fcgi</span>():
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())
</span></span><span style="display:flex;"><span>    web<span style="color:#f92672">.</span>wsgi<span style="color:#f92672">.</span>runwsgi <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> func, addr <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>: flups<span style="color:#f92672">.</span>WSGIServer(func, multiplexed<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, bindAddress<span style="color:#f92672">=</span>addr)<span style="color:#f92672">.</span>run()
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run()
</span></span></code></pre></div><h3 id="性能测试">
  性能测试
  <a class="anchor" href="#%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95">#</a>
</h3>
<p>webpy的性能真的是不敢恭维啊</p>
<p>代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#coding: utf-8    </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> web
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>urls <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;Index&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Index</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GET</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Hello, world !</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start</span>():
</span></span><span style="display:flex;"><span>    app <span style="color:#f92672">=</span> web<span style="color:#f92672">.</span>application(urls, globals())
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    start()
</span></span></code></pre></div><p>利用apache 的ab进行压力测试，10并发1000次请求：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt;&gt;&gt; ab -c <span style="color:#ae81ff">10</span> -n <span style="color:#ae81ff">1000</span> http://192.168.95.222:4321/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; This is ApacheBench, Version 2.3 &lt;$Revision: <span style="color:#ae81ff">655654</span> $&gt;
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Copyright <span style="color:#ae81ff">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Benchmarking 192.168.95.222 <span style="color:#f92672">(</span>be patient<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">100</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">200</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">300</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">400</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">500</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">600</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">700</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">800</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">900</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1000</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Finished <span style="color:#ae81ff">1000</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Software:        CherryPy/3.1.2
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Hostname:        192.168.95.222
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Port:            <span style="color:#ae81ff">4321</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Document Path:          /
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Document Length:        <span style="color:#ae81ff">16</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Concurrency Level:      <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time taken <span style="color:#66d9ef">for</span> tests:   6.269 seconds
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Complete requests:      <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Failed requests:        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Write errors:           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Total transferred:      <span style="color:#ae81ff">108000</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; HTML transferred:       <span style="color:#ae81ff">16000</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Requests per second:    159.51 <span style="color:#f92672">[</span><span style="color:#75715e">#/sec] (mean)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time per request:       62.691 <span style="color:#f92672">[</span>ms<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>mean<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time per request:       6.269 <span style="color:#f92672">[</span>ms<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>mean, across all concurrent requests<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Transfer rate:          16.82 <span style="color:#f92672">[</span>Kbytes/sec<span style="color:#f92672">]</span> received
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Connection Times <span style="color:#f92672">(</span>ms<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;               min  mean<span style="color:#f92672">[</span>+/-sd<span style="color:#f92672">]</span> median   max
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Connect:        <span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">1</span>   0.3      <span style="color:#ae81ff">1</span>       <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Processing:    <span style="color:#ae81ff">29</span>   <span style="color:#ae81ff">61</span>  14.7     <span style="color:#ae81ff">61</span>     <span style="color:#ae81ff">373</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Waiting:       <span style="color:#ae81ff">29</span>   <span style="color:#ae81ff">61</span>  14.7     <span style="color:#ae81ff">61</span>     <span style="color:#ae81ff">372</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Total:         <span style="color:#ae81ff">30</span>   <span style="color:#ae81ff">62</span>  14.7     <span style="color:#ae81ff">62</span>     <span style="color:#ae81ff">374</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Percentage of the requests served within a certain time <span style="color:#f92672">(</span>ms<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   50%     <span style="color:#ae81ff">62</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   66%     <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   75%     <span style="color:#ae81ff">65</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   80%     <span style="color:#ae81ff">66</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   90%     <span style="color:#ae81ff">68</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   95%     <span style="color:#ae81ff">70</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   98%     <span style="color:#ae81ff">71</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   99%     <span style="color:#ae81ff">73</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;  100%    <span style="color:#ae81ff">374</span> <span style="color:#f92672">(</span>longest request<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>平均每秒只能在160s，太低了。</p>
<p><strong>再来看 100并发，2000请求</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt;&gt;&gt; ab -c <span style="color:#ae81ff">100</span> -n <span style="color:#ae81ff">2000</span> http://192.168.95.222:4321/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; This is ApacheBench, Version 2.3 &lt;$Revision: <span style="color:#ae81ff">655654</span> $&gt;
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Copyright <span style="color:#ae81ff">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Benchmarking 192.168.95.222 <span style="color:#f92672">(</span>be patient<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">200</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">400</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">600</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">800</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1000</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1200</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1400</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1600</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">1800</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Completed <span style="color:#ae81ff">2000</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Finished <span style="color:#ae81ff">2000</span> requests
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Software:        CherryPy/3.1.2
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Hostname:        192.168.95.222
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Server Port:            <span style="color:#ae81ff">4321</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Document Path:          /
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Document Length:        <span style="color:#ae81ff">20</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Concurrency Level:      <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time taken <span style="color:#66d9ef">for</span> tests:   15.158 seconds
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Complete requests:      <span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Failed requests:        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Write errors:           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Total transferred:      <span style="color:#ae81ff">224000</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; HTML transferred:       <span style="color:#ae81ff">40000</span> bytes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Requests per second:    131.94 <span style="color:#f92672">[</span><span style="color:#75715e">#/sec] (mean)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time per request:       757.902 <span style="color:#f92672">[</span>ms<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>mean<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Time per request:       7.579 <span style="color:#f92672">[</span>ms<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>mean, across all concurrent requests<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Transfer rate:          14.43 <span style="color:#f92672">[</span>Kbytes/sec<span style="color:#f92672">]</span> received
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Connection Times <span style="color:#f92672">(</span>ms<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;               min  mean<span style="color:#f92672">[</span>+/-sd<span style="color:#f92672">]</span> median   max
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Connect:        <span style="color:#ae81ff">1</span>   <span style="color:#ae81ff">37</span> 203.5      <span style="color:#ae81ff">1</span>    <span style="color:#ae81ff">1207</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Processing:    <span style="color:#ae81ff">58</span>  <span style="color:#ae81ff">707</span> 915.3    <span style="color:#ae81ff">640</span>    <span style="color:#ae81ff">6597</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Waiting:       <span style="color:#ae81ff">57</span>  <span style="color:#ae81ff">707</span> 915.3    <span style="color:#ae81ff">639</span>    <span style="color:#ae81ff">6596</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Total:         <span style="color:#ae81ff">61</span>  <span style="color:#ae81ff">744</span> 1076.6    <span style="color:#ae81ff">641</span>    <span style="color:#ae81ff">7802</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; 
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Percentage of the requests served within a certain time <span style="color:#f92672">(</span>ms<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   50%    <span style="color:#ae81ff">641</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   66%    <span style="color:#ae81ff">647</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   75%    <span style="color:#ae81ff">650</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   80%    <span style="color:#ae81ff">652</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   90%    <span style="color:#ae81ff">667</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   95%   <span style="color:#ae81ff">2641</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   98%   <span style="color:#ae81ff">7173</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;   99%   <span style="color:#ae81ff">7674</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt;  100%   <span style="color:#ae81ff">7802</span> <span style="color:#f92672">(</span>longest request<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>每秒：131个请求，响应时间是：757ms左右。无法忍受了。</p></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/RyanPoy/blog/commit/59b21c1a6f332e258b038cd370ffb8ff92da40ec" title='Last modified by pengyi | July 16, 2025' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>July 16, 2025</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#server">Server</a></li>
        <li><a href="#template">Template</a></li>
        <li><a href="#数据库操作">数据库操作</a>
          <ul>
            <li><a href="#cgi配置">cgi配置</a></li>
            <li><a href="#性能测试">性能测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












