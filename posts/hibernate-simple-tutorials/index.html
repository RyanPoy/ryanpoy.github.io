<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Hibernate入门使用文章, 主要讲快速使用，不会介绍太多的深层次的东西。方便自己，方便大家。因本人懒惰，记不住hibernate的配置选项，所以，此文实例都是使用myeclipse进行快速开发，数据库都是mysql。">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="/posts/hibernate-simple-tutorials/">
  <meta property="og:site_name" content="一哥黑板报">
  <meta property="og:title" content="Hibernate入门使用">
  <meta property="og:description" content="Hibernate入门使用文章, 主要讲快速使用，不会介绍太多的深层次的东西。方便自己，方便大家。因本人懒惰，记不住hibernate的配置选项，所以，此文实例都是使用myeclipse进行快速开发，数据库都是mysql。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2008-07-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-16T11:59:55+08:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Hibernate">
<title>Hibernate入门使用 | 一哥黑板报</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="/posts/hibernate-simple-tutorials/">
<link rel="stylesheet" href="/book.min.e47103a2785905b5db8438d6a609c05371af6c90eabdc369de60b296f8bba830.css" >
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.ddaf773e60b30105a49b6224bc20f89fff6b2ea6aef5d882522c04567545908d.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>一哥黑板报</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/example/" class="">Example Site</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/example/table-of-contents/" class="">Table of Contents</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/example/table-of-contents/with-toc/" class="">With ToC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/table-of-contents/without-toc/" class="">Without ToC</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3cac40e98ef6004516ceb5fd9190d720" class="toggle"  />
    <label for="section-3cac40e98ef6004516ceb5fd9190d720" class="flex">
      <a role="button" class="flex-auto ">Collapsed</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/example/collapsed/3rd-level/" class="">3rd Level</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/example/collapsed/3rd-level/4th-level/" class="">4th Level</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Shortcodes</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/buttons/" class="">Buttons</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/columns/" class="">Columns</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/details/" class="">Details</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/hints/" class="">Hints</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/mermaid/" class="">Mermaid</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/tabs/" class="">Tabs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcodes/katex/" class="">KaTeX</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/RyanPoy/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Hibernate入门使用</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#初次使用">初次使用</a>
          <ul>
            <li><a href="#pojo">Pojo</a></li>
            <li><a href="#db">DB</a></li>
            <li><a href="#hibernatecfgxml">hibernate.cfg.xml</a></li>
            <li><a href="#userhbmxml">User.hbm.xml</a></li>
            <li><a href="#testing">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-11">xml关系映射 1:1</a>
          <ul>
            <li><a href="#db-1">DB</a></li>
            <li><a href="#pojo-1">Pojo</a></li>
            <li><a href="#mapping-xml">Mapping Xml</a></li>
            <li><a href="#testing-1">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-1n">xml关系映射 1:n</a>
          <ul>
            <li><a href="#db-2">DB</a></li>
            <li><a href="#pojo-2">Pojo</a></li>
            <li><a href="#mapping-xml-1">Mapping Xml</a></li>
            <li><a href="#testing-2">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-nn">xml关系映射 n:n</a>
          <ul>
            <li><a href="#db-3">DB</a></li>
            <li><a href="#pojo-3">Pojo</a></li>
            <li><a href="#mapping-xml-2">Mapping Xml</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射---复杂的case">xml关系映射 - 复杂的case</a>
          <ul>
            <li><a href="#db-4">DB</a></li>
            <li><a href="#pojo-4">Pojo</a></li>
            <li><a href="#mapping-xml-3">Mapping Xml</a></li>
            <li><a href="#testing-3">Testing</a></li>
          </ul>
        </li>
        <li><a href="#annotation关系映射-11">annotation关系映射 1:1</a>
          <ul>
            <li><a href="#pojo-5">Pojo</a></li>
            <li><a href="#db-5">DB</a></li>
          </ul>
        </li>
        <li><a href="#annotation的关系映射-1n">annotation的关系映射 1:n</a>
          <ul>
            <li><a href="#pojo-6">Pojo</a></li>
            <li><a href="#db-6">DB</a></li>
          </ul>
        </li>
        <li><a href="#annotation的关系映射-nn">annotation的关系映射 n:n</a>
          <ul>
            <li><a href="#pojo-7">Pojo</a></li>
            <li><a href="#db-7">DB</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    Hibernate入门使用
  </h1>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/svg/calendar.svg" class="book-icon " alt="" />
    <span>July 24, 2008</span>
  </div>



  
  <div class="text-small">
    
      <a href="/categories/Tutorials/">Tutorials</a>
  </div>
  

  
  <div class="text-small">
    
      <a href="/tags/Java/">Java</a>, 
      <a href="/tags/Hibernate/">Hibernate</a>
  </div>
  


  <div class="book-post-content"><p>Hibernate入门使用文章, 主要讲快速使用，不会介绍太多的深层次的东西。方便自己，方便大家。因本人懒惰，记不住hibernate的配置选项，所以，此文实例都是使用myeclipse进行快速开发，数据库都是mysql。</p>
<h2 id="初次使用">
  初次使用
  <a class="anchor" href="#%e5%88%9d%e6%ac%a1%e4%bd%bf%e7%94%a8">#</a>
</h2>
<p>直接上需求：实现对用户的增、删、改、查。</p>
<p>为了方便，用户就2个属性 用户ID和用户名。实体模型如下：</p>
<p>
  <img src="/images/hibernate-1.gif" alt="Imgurl" /></p>
<p>建立工程:HibernateQuickUse，并且建立包。如下：</p>
<p>
  <img src="/images/hibernate-2.gif" alt="Imgurl" /></p>
<h3 id="pojo">
  Pojo
  <a class="anchor" href="#pojo">#</a>
</h3>
<p>根据实体，创建类User，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">User</span>() { }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }   
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }  
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="db">
  DB
  <a class="anchor" href="#db">#</a>
</h3>
<p>根据实体，创建数据表。sql如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>use HibernateQuickUse;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> <span style="color:#66d9ef">User</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">user</span> (
</span></span><span style="display:flex;"><span>	id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>这里的id，我没有采用Integer auto_increment, 原因是为了数据库的数据能方便的导入到另外一种数据库里面，比方说：oracle。当然，这个是以牺牲部分效率为前提的。因为id是integer的，能更加快速查询。不过，从数据库会自动为 primary key 建立 index来看，效率也不会相差太多。</p>
<h3 id="hibernatecfgxml">
  hibernate.cfg.xml
  <a class="anchor" href="#hibernatecfgxml">#</a>
</h3>
<p>要想通过hibernate访问数据库。首先要建立描述数据库的文件：hibernate.cfg.xml。放到src下面。内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-configuration PUBLIC  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			&#34;-//Hibernate/Hibernate Configuration DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			&#34;http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-configuration&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;session-factory&gt;</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">&lt;!-- dialect, 这个对应着hibernate生成哪种数据库的sql。--&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;dialect&#34;</span><span style="color:#f92672">&gt;</span>org.hibernate.dialect.MySQLDialect<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;connection.url&#34;</span><span style="color:#f92672">&gt;</span>jdbc:mysql://localhost:3306/hibernatequickUse<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;connection.username&#34;</span><span style="color:#f92672">&gt;</span>root<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;connection.password&#34;</span><span style="color:#f92672">&gt;</span>root<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;connection.driver_class&#34;</span><span style="color:#f92672">&gt;</span>com.mysql.jdbc.Driver<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">&lt;!-- show_sql, 这个是为了调试时候输出sql语句到屏幕用 --&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;show_sql&#34;</span><span style="color:#f92672">&gt;</span>true<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;mapping</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;org/py/hib/quickstart/User.hbm.xml&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/session-factory&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-configuration&gt;</span>
</span></span></code></pre></div><h3 id="userhbmxml">
  User.hbm.xml
  <a class="anchor" href="#userhbmxml">#</a>
</h3>
<p>实体-数据库映射文件 &ndash; 主要是告诉hibernate，这个User类，对应着哪个table，User类里面的那个属性对应着table里面的哪个字段。</p>
<p>我们可以建立 实体-数据库 的xml映射文件，也可以采用Annotations映射，但是目前只说xml映射方式。如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.quickstart.User&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">&lt;!-- id的生成策略采用 uuid，也可以是 native等 --&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span>  <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span>
</span></span></code></pre></div><h3 id="testing">
  Testing
  <a class="anchor" href="#testing">#</a>
</h3>
<p>有了上面的准备，那么我们开始来用junit测试.
我把测试用力放到了test/org.py.hib.quickstart下面。代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.Assert;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.TestCase;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Session;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.SessionFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Transaction;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.cfg.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.After;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.Before;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">QuickStartTest</span> <span style="color:#66d9ef">extends</span> TestCase {
</span></span><span style="display:flex;"><span>    SessionFactory factory;
</span></span><span style="display:flex;"><span>    String m_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ryanpoy&#34;</span>;
</span></span><span style="display:flex;"><span>    String m_name2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ryanpoy2&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Before</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUp</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        Configuration conf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration().<span style="color:#a6e22e">configure</span>();
</span></span><span style="display:flex;"><span>        factory <span style="color:#f92672">=</span> conf.<span style="color:#a6e22e">buildSessionFactory</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testSave</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test save ===&#34;</span>);
</span></span><span style="display:flex;"><span>        User u <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User();
</span></span><span style="display:flex;"><span>        u.<span style="color:#a6e22e">setName</span>(m_name); <span style="color:#75715e">// 设置用户名 = m_name</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">save</span>(u);
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(u.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">rollback</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testFind</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;=== test find ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            User u <span style="color:#f92672">=</span> (User) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34; from User&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, u.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(m_name, u.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testModify</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>            User u <span style="color:#f92672">=</span> (User) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34; from User&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            u.<span style="color:#a6e22e">setName</span>(m_name2);  <span style="color:#75715e">// 修改用户名 = m_name2.（原来用户名= m_name）</span>
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 修改后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            User u <span style="color:#f92672">=</span> (User) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34; from User&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, u.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(m_name2, u.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDelete</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            User u <span style="color:#f92672">=</span> (User) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34; from User&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">delete</span>(u);
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 删除后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Integer num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34; from User&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@After</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tearDown</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        factory.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>运行后，我们很欣慰的看到一路绿灯，全部通过了。那么测试没有问题。呵呵(这里的测试可能还不完善。请大家指出。前面说过，我对测试这块也不熟)。</p>
<p>看控制台，会输出如下信息：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">===</span> test save <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> hibernatequickuse.<span style="color:#66d9ef">user</span> (name, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> user0_.id <span style="color:#66d9ef">as</span> id2_, user0_.name <span style="color:#66d9ef">as</span> name2_ <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> user0_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> user0_.id <span style="color:#66d9ef">as</span> id4_, user0_.name <span style="color:#66d9ef">as</span> name4_ <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> user0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> hibernatequickuse.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> user0_.id <span style="color:#66d9ef">as</span> id4_, user0_.name <span style="color:#66d9ef">as</span> name4_ <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> user0_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> user0_.id <span style="color:#66d9ef">as</span> id6_, user0_.name <span style="color:#66d9ef">as</span> name6_ <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> user0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> user0_.id <span style="color:#66d9ef">as</span> id6_, user0_.name <span style="color:#66d9ef">as</span> name6_ <span style="color:#66d9ef">from</span> hibernatequickuse.<span style="color:#66d9ef">user</span> user0_
</span></span></code></pre></div><p>这些，就是hibernte自动生成的。仔细看看，其实就是标准sql。呵呵。懂jdbc的都能看懂。</p>
<h2 id="xml关系映射-11">
  xml关系映射 1:1
  <a class="anchor" href="#xml%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-11">#</a>
</h2>
<p>1对1的关系在现实中很常见。比方说：人和身份证。1个身份证对应着一个身份证，一个身份证对应着一个人。那么，我们就以此为原型。进行代码编写。</p>
<p>实体模型</p>
<p>
  <img src="/images/hibernate-3.gif" alt="1对1实体模型" /></p>
<h3 id="db-1">
  DB
  <a class="anchor" href="#db-1">#</a>
</h3>
<p>根据模型，创建数据库：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>use HibernateQuickUse;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Person;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Card;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Card (
</span></span><span style="display:flex;"><span>	id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	cardDesc varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Person (
</span></span><span style="display:flex;"><span>	id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	card_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(card_id) <span style="color:#66d9ef">references</span> Card(id)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="pojo-1">
  Pojo
  <a class="anchor" href="#pojo-1">#</a>
</h3>
<p>java代码如下：</p>
<p>Person类</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Card card;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Person</span>() { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Card <span style="color:#a6e22e">getCard</span>() {<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">card</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCard</span>(Card card) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">card</span> <span style="color:#f92672">=</span> card; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Card类：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Card</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String cardDesc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Card</span>() { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCardDesc</span>() { <span style="color:#66d9ef">return</span> cardDesc; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCardDesc</span>(String cardDesc) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cardDesc</span> <span style="color:#f92672">=</span> cardDesc; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mapping-xml">
  Mapping Xml
  <a class="anchor" href="#mapping-xml">#</a>
</h3>
<p>xml映射文件如下：</p>
<p>Person.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2one.Person&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;person&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;column</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/property&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;many-to-one</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;card&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2one.Card&#34;</span> <span style="color:#a6e22e">unique=</span><span style="color:#e6db74">&#34;true&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;card_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span>
</span></span></code></pre></div><p>今天讲的是one-to-one配置。但是，此处用的是many-to-one，这个是什么原因呢？其实，one-to-one就是特殊的many-to-one。</p>
<p>Card.hbm.xml：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2one.Card&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;card&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;cardDesc&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cardDesc&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;128&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><h3 id="testing-1">
  Testing
  <a class="anchor" href="#testing-1">#</a>
</h3>
<p>测试代码如下：</p>
<p>One2OneTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.Assert;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.TestCase;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Session;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.SessionFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Transaction;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.cfg.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.After;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.Before;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">One2OneTest</span> <span style="color:#66d9ef">extends</span> TestCase {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> SessionFactory factory;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String m_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ryanpoy&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String m_name2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ryanpoy2&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String m_cardDesc1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;desc_1&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String m_cardDesc2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;desc_2&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Before</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUp</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		Configuration conf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration().<span style="color:#a6e22e">configure</span>();
</span></span><span style="display:flex;"><span>		factory <span style="color:#f92672">=</span> conf.<span style="color:#a6e22e">buildSessionFactory</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testSave</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test save ===&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Card card <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Card();
</span></span><span style="display:flex;"><span>		card.<span style="color:#a6e22e">setCardDesc</span>(m_cardDesc1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Person person <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person();
</span></span><span style="display:flex;"><span>		person.<span style="color:#a6e22e">setName</span>(m_name); <span style="color:#75715e">// 设置用户名 = m_name</span>
</span></span><span style="display:flex;"><span>		person.<span style="color:#a6e22e">setCard</span>(card);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>			session.<span style="color:#a6e22e">save</span>(person);
</span></span><span style="display:flex;"><span>			tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(person.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(card.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			tran.<span style="color:#a6e22e">rollback</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testFind</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find ===&#34;</span>);
</span></span><span style="display:flex;"><span>		Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>			Person person <span style="color:#f92672">=</span> (Person) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Person&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, person.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(m_name, person.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, person.<span style="color:#a6e22e">getCard</span>().<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(m_cardDesc1, person.<span style="color:#a6e22e">getCard</span>().<span style="color:#a6e22e">getCardDesc</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testModify</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>		Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>			tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Person person <span style="color:#f92672">=</span> (Person) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Person&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>			person.<span style="color:#a6e22e">setName</span>(m_name2); <span style="color:#75715e">// 修改用户名 = m_name2.（原来用户名= m_name）</span>
</span></span><span style="display:flex;"><span>			person.<span style="color:#a6e22e">getCard</span>().<span style="color:#a6e22e">setCardDesc</span>(m_cardDesc2); <span style="color:#75715e">// 修改cardDesc 为 m_cardDesc2 (原来是：m_cardDesc1)</span>
</span></span><span style="display:flex;"><span>			tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>			Person person <span style="color:#f92672">=</span> (Person) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Person&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, person.<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(m_name2, person.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#66d9ef">true</span>, person.<span style="color:#a6e22e">getCard</span>().<span style="color:#a6e22e">getId</span>() <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(m_cardDesc2, person.<span style="color:#a6e22e">getCard</span>().<span style="color:#a6e22e">getCardDesc</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDelete</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>		Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>			tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Person person <span style="color:#f92672">=</span> (Person) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Person&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>			session.<span style="color:#a6e22e">delete</span>(person);
</span></span><span style="display:flex;"><span>			tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		 * 删除后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		 */</span>
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			Integer num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Person&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Card&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>			Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>					session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>				} <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>						session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@After</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tearDown</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		factory.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>运行test，一路飚绿。呵呵。陶醉一番。不过，这也就是一个拿不出手的测试和一个拿不出手的例子。没有任何实际意义的例子。仅此一个demo而已。</p>
<p>在1：1中，其实还有一种方式，即：唯一主见关联。但是，我一直倾向于上面的这种形式，所以，唯一主见关联的就不再介绍了。</p>
<h2 id="xml关系映射-1n">
  xml关系映射 1:n
  <a class="anchor" href="#xml%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-1n">#</a>
</h2>
<p>因为n:1就是1:1，两者是一样的，所以不单独说了。下面主要讲主要讲1:n：</p>
<p>这次用到的例子是Father和child之间的关系。一个father可以有n个child，但是1个child只有一个father。这里只说生父。至于其他的继父、养父、干爹等等，不再范围之内。</p>
<p>建立实体模型如下：</p>
<p>
  <img src="/images/hibernate-4.gif" alt="One2Many" /></p>
<h3 id="db-2">
  DB
  <a class="anchor" href="#db-2">#</a>
</h3>
<p>根据模型创建数据库。sql脚本如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>use HibernateQuickUse;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Child;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Father;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Father (
</span></span><span style="display:flex;"><span>	id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Child (
</span></span><span style="display:flex;"><span>	id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	father_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(father_id) <span style="color:#66d9ef">references</span> Father(id)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="pojo-2">
  Pojo
  <a class="anchor" href="#pojo-2">#</a>
</h3>
<p>根据模型创建java对象。</p>
<p>Father.java：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashSet;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Father</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Set children <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Set <span style="color:#a6e22e">getChildren</span>() { <span style="color:#66d9ef">return</span> children; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setChildren</span>(Set children) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> children; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Child.java：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Child</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Father father;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Father <span style="color:#a6e22e">getFather</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">father</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setFather</span>(Father father) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">father</span> <span style="color:#f92672">=</span> father; }
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mapping-xml-1">
  Mapping Xml
  <a class="anchor" href="#mapping-xml-1">#</a>
</h3>
<p>映射文件如下：</p>
<p>Father.hbm.xml：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2many.Father&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;father&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;set</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;children&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;child&#34;</span> <span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">inverse=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;key</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;father_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;one-to-many</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2many.Child&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/set&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><p>这里要说说 &ldquo;set&rdquo; 这个标签里面的内容。</p>
<ol>
<li>&ldquo;name&quot;是Father里面的属性的名字。</li>
<li>&ldquo;table&quot;表示它对应的是数据库中的哪个表。</li>
<li>cascade=&ldquo;all&rdquo; 表示所有的操作都级联操作。</li>
<li>&ldquo;inverse&quot;表示关系的维护由谁来执行。
<blockquote>
<p>true表示不由自己执行，而有对应的另外一方执行。
false则相反，表示由自己维护关系。
这里设置成 true 是由原因的。如果说把它设置成为false，那么就由他来维护关系了。</p></blockquote>
</li>
</ol>
<p><strong>这里得说一下inverse属性的问题</strong>。在one-to-many中，如果关系由one来维护，那么会很麻烦，性能也会很低。每次对many一方的一条记录进行增、删、改 时都会多一次update操作。原因很简单，因为关系的维护设置在了one这一方，所以对many的每一次操作，one这一方都要维护一次双方的关系。</p>
<p>这个就好像皇帝和老百姓的关系。试问，是来一个老百姓，皇帝就宣布他是我的子民，还是由老百姓直接选择做那个皇帝的子民更加有效率呢？呵呵。不知道这个例子大家有没有明白。关于inverse的更具体的说明，在javaeye上搜一下，就会发现有很多。这里推荐一篇，我认为讲得很明白的： 
  <a href="http://www.iteye.com/topic/156289">inverse</a></p>
<p>&ldquo;key&rdquo; 中的 &ldquo;column&rdquo; 表示在table(这里的table是child)中, 跟Father关联的字段名称。这里是&quot;father_id&rdquo;。可以看看开始的sql脚本。</p>
<p>one-to-many 表示father和children的关系。class则表示是同哪个类是这种关系。</p>
<p>Child.hbm.xml：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2many.Child&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;child&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;128&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;many-to-one</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;father&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.one2many.Father&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;father_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><p>这个里面主要就是多了一个many-to-one，表示child 和 father 的关系是&quot;many-to-one&rdquo;</p>
<h3 id="testing-2">
  Testing
  <a class="anchor" href="#testing-2">#</a>
</h3>
<p>测试代码如下：</p>
<p>One2ManyTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.Assert;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.TestCase;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Session;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.SessionFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Transaction;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.cfg.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.After;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.Before;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">One2ManyTest</span> <span style="color:#66d9ef">extends</span> TestCase {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> SessionFactory factory;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String<span style="color:#f92672">[]</span> childname <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span>{<span style="color:#e6db74">&#34;child_1&#34;</span>, <span style="color:#e6db74">&#34;child_2&#34;</span>, <span style="color:#e6db74">&#34;child_3&#34;</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String<span style="color:#f92672">[]</span> newchildname <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span>{<span style="color:#e6db74">&#34;new_child_1&#34;</span>, <span style="color:#e6db74">&#34;new_child_2&#34;</span>, <span style="color:#e6db74">&#34;new_child_3&#34;</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Before</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUp</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        Configuration conf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration().<span style="color:#a6e22e">configure</span>();
</span></span><span style="display:flex;"><span>        factory <span style="color:#f92672">=</span> conf.<span style="color:#a6e22e">buildSessionFactory</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testSave</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test save ===&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Father father <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Father();
</span></span><span style="display:flex;"><span>        father.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;Father_1&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Child child1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Child();
</span></span><span style="display:flex;"><span>        child1.<span style="color:#a6e22e">setName</span>(childname<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Child child2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Child();
</span></span><span style="display:flex;"><span>        child2.<span style="color:#a6e22e">setName</span>(childname<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Child child3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Child();
</span></span><span style="display:flex;"><span>        child3.<span style="color:#a6e22e">setName</span>(childname<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        father.<span style="color:#a6e22e">getChildren</span>().<span style="color:#a6e22e">add</span>(child1);
</span></span><span style="display:flex;"><span>        father.<span style="color:#a6e22e">getChildren</span>().<span style="color:#a6e22e">add</span>(child2);
</span></span><span style="display:flex;"><span>        father.<span style="color:#a6e22e">getChildren</span>().<span style="color:#a6e22e">add</span>(child3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        child1.<span style="color:#a6e22e">setFather</span>(father);
</span></span><span style="display:flex;"><span>        child2.<span style="color:#a6e22e">setFather</span>(father);
</span></span><span style="display:flex;"><span>        child3.<span style="color:#a6e22e">setFather</span>(father);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">save</span>(father);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(father.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(child1.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(child2.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(child3.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">rollback</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isChildrenName</span>(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String n : childname) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (n.<span style="color:#a6e22e">equals</span>(name))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isNewChildrenName</span>(String name) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String n : newchildname) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (n.<span style="color:#a6e22e">equals</span>(name))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testFind</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Father father <span style="color:#f92672">=</span> (Father) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Father&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(father.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#e6db74">&#34;Father_1&#34;</span>, father.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Set children <span style="color:#f92672">=</span> father.<span style="color:#a6e22e">getChildren</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Child child : children) {
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertEquals</span>(child.<span style="color:#a6e22e">getFather</span>(), father);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertNotNull</span>(child.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertTrue</span>(isChildrenName(child.<span style="color:#a6e22e">getName</span>()));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testModify</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Father father <span style="color:#f92672">=</span> (Father) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Father&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            father.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;Father_2&#34;</span>); <span style="color:#75715e">// 修改用户名 = m_name2.（原来用户名= m_name）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Set children <span style="color:#f92672">=</span> father.<span style="color:#a6e22e">getChildren</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Child child : children) {
</span></span><span style="display:flex;"><span>                child.<span style="color:#a6e22e">setName</span>(newchildname<span style="color:#f92672">[</span>i<span style="color:#f92672">++]</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 修改后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Father father <span style="color:#f92672">=</span> (Father) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Father&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(father.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(<span style="color:#e6db74">&#34;Father_2&#34;</span>, father.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Set children <span style="color:#f92672">=</span> father.<span style="color:#a6e22e">getChildren</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Child child : children) {
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertEquals</span>(child.<span style="color:#a6e22e">getFather</span>(), father);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertNotNull</span>(child.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertTrue</span>(isNewChildrenName(child.<span style="color:#a6e22e">getName</span>()));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDelete</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Father father <span style="color:#f92672">=</span> (Father) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Father&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">delete</span>(father);
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 删除后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Integer num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Father&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Child&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@After</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tearDown</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        factory.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里不得不再重申以下 one-to-many 中 inverse 关系的维护问题。 在one-to-many中，把inverse放到many中来维护是一个好的习惯。大家可以把上面的inverse改成false，看看会发生什么情况。</p>
<p>在inverse=true的时候，输出结果如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">===</span> test save <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> father (name, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id13_, father0_.name <span style="color:#66d9ef">as</span> name13_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id14_0_, children0_.name <span style="color:#66d9ef">as</span> name14_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_14_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> father <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id33_, father0_.name <span style="color:#66d9ef">as</span> name33_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id34_0_, children0_.name <span style="color:#66d9ef">as</span> name34_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_34_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> father <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id33_, father0_.name <span style="color:#66d9ef">as</span> name33_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> child0_.id <span style="color:#66d9ef">as</span> id34_, child0_.name <span style="color:#66d9ef">as</span> name34_, child0_.father_id <span style="color:#66d9ef">as</span> father3_34_ <span style="color:#66d9ef">from</span> child child0_
</span></span></code></pre></div><p>而改成<strong>inverse=false</strong>后，testDelete()是没法通过的。输出如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>log4j:WARN <span style="color:#66d9ef">No</span> appenders could be <span style="color:#66d9ef">found</span> <span style="color:#66d9ef">for</span> logger (org.hibernate.cfg.Environment).
</span></span><span style="display:flex;"><span>log4j:WARN Please <span style="color:#66d9ef">initialize</span> the log4j <span style="color:#66d9ef">system</span> properly.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test save <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> father (name, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id13_, father0_.name <span style="color:#66d9ef">as</span> name13_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id14_0_, children0_.name <span style="color:#66d9ef">as</span> name14_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_14_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> father <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id33_, father0_.name <span style="color:#66d9ef">as</span> name33_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id34_0_, children0_.name <span style="color:#66d9ef">as</span> name34_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_34_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span> <span style="color:#66d9ef">where</span> father_id<span style="color:#f92672">=?</span>
</span></span></code></pre></div><p>产生了错误，原因是：违反了非空约束。</p>
<p>得修改sql脚本，把Child的建表脚本中的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>father_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, 
</span></span></code></pre></div><p>修改成为：</p>
<pre tabindex="0"><code>father_id varchar(32),
</code></pre><p>才能通过。这个时候输出的结果是：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>log4j:WARN <span style="color:#66d9ef">No</span> appenders could be <span style="color:#66d9ef">found</span> <span style="color:#66d9ef">for</span> logger (org.hibernate.cfg.Environment).
</span></span><span style="display:flex;"><span>log4j:WARN Please <span style="color:#66d9ef">initialize</span> the log4j <span style="color:#66d9ef">system</span> properly.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test save <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> father (name, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> child (name, father_id, id) <span style="color:#66d9ef">values</span> (<span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>, <span style="color:#f92672">?</span>)
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id13_, father0_.name <span style="color:#66d9ef">as</span> name13_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id14_0_, children0_.name <span style="color:#66d9ef">as</span> name14_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_14_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> father <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=?</span>, father_id<span style="color:#f92672">=?</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">modify</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id23_, father0_.name <span style="color:#66d9ef">as</span> name23_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id24_0_, children0_.name <span style="color:#66d9ef">as</span> name24_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_24_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id33_, father0_.name <span style="color:#66d9ef">as</span> name33_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> children0_.father_id <span style="color:#66d9ef">as</span> father3_1_, children0_.id <span style="color:#66d9ef">as</span> id1_, children0_.id <span style="color:#66d9ef">as</span> id34_0_, children0_.name <span style="color:#66d9ef">as</span> name34_0_, children0_.father_id <span style="color:#66d9ef">as</span> father3_34_0_ <span style="color:#66d9ef">from</span> child children0_ <span style="color:#66d9ef">where</span> children0_.father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">update</span> child <span style="color:#66d9ef">set</span> father_id<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span> <span style="color:#66d9ef">where</span> father_id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> child <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> father <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===</span> test find <span style="color:#66d9ef">after</span> <span style="color:#66d9ef">delete</span> <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> father0_.id <span style="color:#66d9ef">as</span> id33_, father0_.name <span style="color:#66d9ef">as</span> name33_ <span style="color:#66d9ef">from</span> father father0_
</span></span><span style="display:flex;"><span>Hibernate: <span style="color:#66d9ef">select</span> child0_.id <span style="color:#66d9ef">as</span> id34_, child0_.name <span style="color:#66d9ef">as</span> name34_, child0_.father_id <span style="color:#66d9ef">as</span> father3_34_ <span style="color:#66d9ef">from</span> child child0_
</span></span></code></pre></div><p>所以，<strong>inverse的设置是很重要的一个事情。</strong></p>
<h2 id="xml关系映射-nn">
  xml关系映射 n:n
  <a class="anchor" href="#xml%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-nn">#</a>
</h2>
<p>我们以老师和学生为例，一个老师可以交很多学生，同样一个学生可以拥有多个老师，所以，他们之间的关系就是n：n的。</p>
<p>实体模型：

  <img src="/images/hibernate-5.gif" alt="many2many" /></p>
<p>从实体模型来看。有2个对象，但是为了在数据库中表示出2者的n:n的关系，我们还得引入一张表。</p>
<h3 id="db-3">
  DB
  <a class="anchor" href="#db-3">#</a>
</h3>
<p>sql脚本如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>use HibernateQuickUse;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> teacher_student_relation;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Teacher;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Student;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Teacher (
</span></span><span style="display:flex;"><span>	tid varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Student (
</span></span><span style="display:flex;"><span>	sid varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> teacher_student_relation (
</span></span><span style="display:flex;"><span>	id integer auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	teacher_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	student_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(teacher_id) <span style="color:#66d9ef">references</span> Teacher(tid),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(student_id) <span style="color:#66d9ef">references</span> Student(sid)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="pojo-3">
  Pojo
  <a class="anchor" href="#pojo-3">#</a>
</h3>
<p>通过模型，创建java类如下：</p>
<p>Student.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashSet;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Set teachers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Student</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() {<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() {<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Set <span style="color:#a6e22e">getTeachers</span>() {<span style="color:#66d9ef">return</span> teachers;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setTeachers</span>(Set teachers) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">teachers</span> <span style="color:#f92672">=</span> teachers;}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Teacher.java:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashSet;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Teacher</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Set students <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet(0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Teacher</span>() {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Set <span style="color:#a6e22e">getStudents</span>() { <span style="color:#66d9ef">return</span> students;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setStudents</span>(Set students) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">students</span> <span style="color:#f92672">=</span> students;}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mapping-xml-2">
  Mapping Xml
  <a class="anchor" href="#mapping-xml-2">#</a>
</h3>
<p>xml映射文件如下</p>
<p>Student.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.many2many.Student&#34;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;student&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;sid&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;128&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;set</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;teachers&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;teacher_student_relation&#34;</span> <span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;save-update&#34;</span> <span style="color:#a6e22e">inverse=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;key</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;student_id&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;many-to-many</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;teacher_id&#34;</span>  
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.many2many.Teacher&#34;</span>   
</span></span><span style="display:flex;"><span>				<span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/set&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span>
</span></span></code></pre></div><p><strong>注意</strong></p>
<ol>
<li>set中的 table 指向的是数据库中的关联表。</li>
<li>cascade 用的是save-update , 且inverse用的是false，这样的话，当进行修改和保存和删除时，关联表中的记录也会删掉.</li>
<li>如果cascade 用的是 all 那么连同student表中的记录也会被删除掉。</li>
<li>key中的column指的是： 关联表中与Student发生关系的字段。</li>
<li>而many-to-many中的column指的是：关联表中，与class(这里是：org.py.hib.relation.many2many.Teacher)发生关系的字段。</li>
</ol>
<p>Teacher.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.many2many.Teacher&#34;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;teacher&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tid&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;set</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;students&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;teacher_student_relation&#34;</span> <span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;save-update&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">inverse=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;key</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;teacher_id&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;many-to-many</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.many2many.Student&#34;</span>  
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;student_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/set&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span>
</span></span></code></pre></div><p><strong>注意：</strong> 这里的inverse也采用了false，这样子的话，Teacher和Student都维护关系表中的关系。</p>
<p>测试类，Many2ManyTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Iterator;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.Assert;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.TestCase;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Session;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.SessionFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Transaction;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.cfg.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.After;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.Before;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Many2ManyTest</span> <span style="color:#66d9ef">extends</span> TestCase {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> SessionFactory factory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Before</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUp</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        Configuration conf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration().<span style="color:#a6e22e">configure</span>();
</span></span><span style="display:flex;"><span>        factory <span style="color:#f92672">=</span> conf.<span style="color:#a6e22e">buildSessionFactory</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testSave</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test save ===&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Teacher teacher1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Teacher();
</span></span><span style="display:flex;"><span>        teacher1.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;teacher_1&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Teacher teacher2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Teacher();
</span></span><span style="display:flex;"><span>        teacher2.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;teacher_2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Student stu1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Student();
</span></span><span style="display:flex;"><span>        stu1.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;student_1&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Student stu2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Student();
</span></span><span style="display:flex;"><span>        stu2.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;student_2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stu1.<span style="color:#a6e22e">getTeachers</span>().<span style="color:#a6e22e">add</span>(teacher1);
</span></span><span style="display:flex;"><span>        stu1.<span style="color:#a6e22e">getTeachers</span>().<span style="color:#a6e22e">add</span>(teacher2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        stu2.<span style="color:#a6e22e">getTeachers</span>().<span style="color:#a6e22e">add</span>(teacher2);
</span></span><span style="display:flex;"><span>        teacher1.<span style="color:#a6e22e">getStudents</span>().<span style="color:#a6e22e">add</span>(stu2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">save</span>(stu1);
</span></span><span style="display:flex;"><span>            session.<span style="color:#a6e22e">save</span>(stu2);
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher1.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher2.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(stu1.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertNotNull</span>(stu2.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">rollback</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testFindFromTeacher</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find from Teacher ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Iterator iter <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Teacher&#34;</span>).<span style="color:#a6e22e">iterate</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (iter.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                Teacher teacher <span style="color:#f92672">=</span> iter.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                String teacherName <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;teacher_1&#34;</span>.<span style="color:#a6e22e">equals</span>(teacherName)) {
</span></span><span style="display:flex;"><span>                    Set stus <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getStudents</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(stus.<span style="color:#a6e22e">size</span>(), 2);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Student stu : stus) {
</span></span><span style="display:flex;"><span>                        String stuName <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(stu.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_1&#34;</span>) <span style="color:#f92672">||</span> stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;teacher_2&#34;</span>.<span style="color:#a6e22e">equals</span>(teacherName)) {
</span></span><span style="display:flex;"><span>                    Set stus <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getStudents</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(stus.<span style="color:#a6e22e">size</span>(), 2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Student stu : stus) {
</span></span><span style="display:flex;"><span>                        String stuName <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(stu.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_1&#34;</span>) <span style="color:#f92672">||</span> stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;teacher name error exception.&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testFindFromStudent</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find from Student ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Iterator iter <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Student&#34;</span>).<span style="color:#a6e22e">iterate</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (iter.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                Student stu <span style="color:#f92672">=</span> iter.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertNotNull</span>(stu.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                String stuName <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;student_1&#34;</span>.<span style="color:#a6e22e">equals</span>(stuName)) {
</span></span><span style="display:flex;"><span>                    Set teachers <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getTeachers</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(teachers.<span style="color:#a6e22e">size</span>(), 2);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Teacher teacher : teachers) {
</span></span><span style="display:flex;"><span>                        String tName <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(tName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;teacher_1&#34;</span>) <span style="color:#f92672">||</span> tName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;teacher_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;student_2&#34;</span>.<span style="color:#a6e22e">equals</span>(stuName)) {
</span></span><span style="display:flex;"><span>                    Set teachers <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getTeachers</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(teachers.<span style="color:#a6e22e">size</span>(), 2);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Teacher teacher : teachers) {
</span></span><span style="display:flex;"><span>                        String tName <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(tName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;teacher_1&#34;</span>) <span style="color:#f92672">||</span> tName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;teacher_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;student name error exception.&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testModify</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test modify ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Teacher t1 <span style="color:#f92672">=</span> (Teacher) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Teacher t where t.name=&#39;teacher_1&#39;&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            t1.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;new_teacher_1&#34;</span>); <span style="color:#75715e">// 修改用户名 = m_name2.（原来用户名= m_name）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Set stus <span style="color:#f92672">=</span> t1.<span style="color:#a6e22e">getStudents</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Student stu : stus) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (stu.<span style="color:#a6e22e">getName</span>().<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_1&#34;</span>)) {
</span></span><span style="display:flex;"><span>                    stus.<span style="color:#a6e22e">remove</span>(stu);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 修改后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find from Teacher after modify===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            Iterator iter <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Teacher&#34;</span>).<span style="color:#a6e22e">iterate</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (iter.<span style="color:#a6e22e">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                Teacher teacher <span style="color:#f92672">=</span> iter.<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>                Assert.<span style="color:#a6e22e">assertNotNull</span>(teacher.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                String teacherName <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;new_teacher_1&#34;</span>.<span style="color:#a6e22e">equals</span>(teacherName)) {
</span></span><span style="display:flex;"><span>                    Set stus <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getStudents</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(stus.<span style="color:#a6e22e">size</span>(), 1);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Student stu : stus) {
</span></span><span style="display:flex;"><span>                        String stuName <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(stu.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#34;teacher_2&#34;</span>.<span style="color:#a6e22e">equals</span>(teacherName)) {
</span></span><span style="display:flex;"><span>                    Set stus <span style="color:#f92672">=</span> teacher.<span style="color:#a6e22e">getStudents</span>();
</span></span><span style="display:flex;"><span>                    Assert.<span style="color:#a6e22e">assertEquals</span>(stus.<span style="color:#a6e22e">size</span>(), 2);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">for</span> (Student stu : stus) {
</span></span><span style="display:flex;"><span>                        String stuName <span style="color:#f92672">=</span> stu.<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertNotNull</span>(stu.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                        Assert.<span style="color:#a6e22e">assertTrue</span>(stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_1&#34;</span>) <span style="color:#f92672">||</span> stuName.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;student_2&#34;</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;teacher name error exception.&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDelete</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        Transaction tran <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>            tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Iterator iter <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Teacher&#34;</span>).<span style="color:#a6e22e">iterate</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (iter.<span style="color:#a6e22e">hasNext</span>())
</span></span><span style="display:flex;"><span>                session.<span style="color:#a6e22e">delete</span>(iter.<span style="color:#a6e22e">next</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Integer count <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;select count(*) from Teacher&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">get</span>(0);
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, count.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * 删除后再查询
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;\n=== test find after delete ===&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Integer num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Teacher&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            num <span style="color:#f92672">=</span> (Integer) session.<span style="color:#a6e22e">createQuery</span>(<span style="color:#e6db74">&#34;from Student&#34;</span>).<span style="color:#a6e22e">list</span>().<span style="color:#a6e22e">size</span>();
</span></span><span style="display:flex;"><span>            Assert.<span style="color:#a6e22e">assertEquals</span>(0, num.<span style="color:#a6e22e">intValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> ex;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// nothing to do</span>
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (session <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>                        session <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@After</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tearDown</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        factory.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>从这个例子中可以看出，many-to-many中，需要引入第3张表来表示关系。</p>
<h2 id="xml关系映射---复杂的case">
  xml关系映射 - 复杂的case
  <a class="anchor" href="#xml%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84---%e5%a4%8d%e6%9d%82%e7%9a%84case">#</a>
</h2>
<p>需求：丈夫有1个妻子，这样是1夫1妻。但是，丈夫花心，同时有多个情妇。</p>
<p>例子归例子，大家不要做这样的丈夫。只是为了更加深入记忆。</p>
<h3 id="db-4">
  DB
  <a class="anchor" href="#db-4">#</a>
</h3>
<p>先看sql：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>use HibernateQuickUse;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Paramour;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Husband;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> Wife;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Wife (
</span></span><span style="display:flex;"><span>	wid varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Husband (
</span></span><span style="display:flex;"><span>	hid varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	wife_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(wife_id) <span style="color:#66d9ef">references</span> Wife(wid)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> Paramour (
</span></span><span style="display:flex;"><span>	pid varchar(<span style="color:#ae81ff">32</span>)  <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>,
</span></span><span style="display:flex;"><span>	name varchar(<span style="color:#ae81ff">128</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	husband_id varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(husband_id) <span style="color:#66d9ef">references</span> Husband(hid)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="pojo-4">
  Pojo
  <a class="anchor" href="#pojo-4">#</a>
</h3>
<p>然后看java文件。</p>
<p>Husband.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashSet;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Set;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Husband</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Wife wife;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Set paramours <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Husband</span>(){}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> name;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Wife <span style="color:#a6e22e">getWife</span>() { <span style="color:#66d9ef">return</span> wife;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setWife</span>(Wife wife) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">wife</span> <span style="color:#f92672">=</span> wife;}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Set <span style="color:#a6e22e">getParamours</span>() { <span style="color:#66d9ef">return</span> paramours;}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setParamours</span>(Set paramours) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">paramours</span> <span style="color:#f92672">=</span> paramours;}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Wife.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Wife</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Wife</span>() { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Paramour.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@SuppressWarnings</span>(<span style="color:#e6db74">&#34;serial&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Paramour</span> <span style="color:#66d9ef">implements</span> java.<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Serializable</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Husband husband;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Paramour</span>(){ }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> Husband <span style="color:#a6e22e">getHusband</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">husband</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setHusband</span>(Husband husband) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">husband</span> <span style="color:#f92672">=</span> husband; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mapping-xml-3">
  Mapping Xml
  <a class="anchor" href="#mapping-xml-3">#</a>
</h3>
<p>接下来再看xml映射文件。</p>
<p>Husband.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Husband&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;husband&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;hid&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;many-to-one</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;wife&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Wife&#34;</span> <span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;wife_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;set</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;paramours&#34;</span> <span style="color:#a6e22e">cascade=</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#a6e22e">inverse=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;key</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;husband_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;one-to-many</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Paramour&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/set&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><p>Wife.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Wife&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;wife&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;wid&#34;</span> <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;32&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span>  <span style="color:#a6e22e">length=</span><span style="color:#e6db74">&#34;128&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><p>Paramour.hbm.xml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE hibernate-mapping PUBLIC &#34;-//Hibernate/Hibernate Mapping DTD 3.0//EN&#34;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	&#34;http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd&#34;&gt;</span>   
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;hibernate-mapping&gt;</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;class</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Paramour&#34;</span> <span style="color:#a6e22e">table=</span><span style="color:#e6db74">&#34;paramour&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pid&#34;</span><span style="color:#f92672">&gt;</span>  
</span></span><span style="display:flex;"><span>			<span style="color:#f92672">&lt;generator</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;uuid&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;/id&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">not-null=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;many-to-one</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;husband&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.py.hib.relation.complex.Husband&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;husband_id&#34;</span> <span style="color:#f92672">/&gt;</span>  
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/class&gt;</span>  
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/hibernate-mapping&gt;</span> 
</span></span></code></pre></div><h3 id="testing-3">
  Testing
  <a class="anchor" href="#testing-3">#</a>
</h3>
<p>这里只测试了save。其他的测试大家感兴趣的可以补充。
ComplexTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.Assert;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> junit.framework.TestCase;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Session;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.SessionFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.Transaction;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.hibernate.cfg.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.After;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.Before;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 这个测试忽略了hibernate的异常
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ComplexTest</span> <span style="color:#66d9ef">extends</span> TestCase {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> SessionFactory factory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Before</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUp</span>() <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>		Configuration conf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Configuration().<span style="color:#a6e22e">configure</span>();
</span></span><span style="display:flex;"><span>		factory <span style="color:#f92672">=</span> conf.<span style="color:#a6e22e">buildSessionFactory</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testSave</span>() {
</span></span><span style="display:flex;"><span>		Session session <span style="color:#f92672">=</span> factory.<span style="color:#a6e22e">openSession</span>();
</span></span><span style="display:flex;"><span>		Transaction tran <span style="color:#f92672">=</span> session.<span style="color:#a6e22e">beginTransaction</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Husband hus <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Husband();
</span></span><span style="display:flex;"><span>		hus.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;husband&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Wife wife <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Wife();
</span></span><span style="display:flex;"><span>		wife.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;wife&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Paramour p1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Paramour();
</span></span><span style="display:flex;"><span>		p1.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;paramour_1&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Paramour p2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Paramour();
</span></span><span style="display:flex;"><span>		p2.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;paramour_2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Paramour p3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Paramour();
</span></span><span style="display:flex;"><span>		p3.<span style="color:#a6e22e">setName</span>(<span style="color:#e6db74">&#34;paramour_3&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		hus.<span style="color:#a6e22e">setWife</span>(wife);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		hus.<span style="color:#a6e22e">getParamours</span>().<span style="color:#a6e22e">add</span>(p1);
</span></span><span style="display:flex;"><span>		hus.<span style="color:#a6e22e">getParamours</span>().<span style="color:#a6e22e">add</span>(p2);
</span></span><span style="display:flex;"><span>		hus.<span style="color:#a6e22e">getParamours</span>().<span style="color:#a6e22e">add</span>(p3);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		p1.<span style="color:#a6e22e">setHusband</span>(hus);
</span></span><span style="display:flex;"><span>		p2.<span style="color:#a6e22e">setHusband</span>(hus);
</span></span><span style="display:flex;"><span>		p3.<span style="color:#a6e22e">setHusband</span>(hus);
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		session.<span style="color:#a6e22e">save</span>(hus);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		tran.<span style="color:#a6e22e">commit</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#a6e22e">assertNotNull</span>(hus.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#a6e22e">assertNotNull</span>(wife.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#a6e22e">assertNotNull</span>(p1.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#a6e22e">assertNotNull</span>(p2.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#a6e22e">assertNotNull</span>(p3.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		session.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@After</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">tearDown</span>() {
</span></span><span style="display:flex;"><span>		factory.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="annotation关系映射-11">
  annotation关系映射 1:1
  <a class="anchor" href="#annotation%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-11">#</a>
</h2>
<p>讲完了xml的关系映射，下面讲一下annatation的关系映射
这讲OneToOne的用法。而且是基于主外键的关联。因为这个是实际开发中最最常见的。</p>
<p>这里先说明一下，我的java类的命名都以Test开头。而对应的对象名却没有用test开头。这里是为了更好的说明注视中的value到底是类名还是对象名。</p>
<h3 id="pojo-5">
  Pojo
  <a class="anchor" href="#pojo-5">#</a>
</h3>
<p>先看java代码：</p>
<p>TestUser.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.OneToOne;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestUser</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	String   id;
</span></span><span style="display:flex;"><span>	String   username;
</span></span><span style="display:flex;"><span>	TestCard card;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() {<span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUsername</span>() {<span style="color:#66d9ef">return</span> username; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUsername</span>(String username) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> username; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@OneToOne</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> TestCard <span style="color:#a6e22e">getCard</span>() {<span style="color:#66d9ef">return</span> card; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCard</span>(TestCard card) {<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">card</span> <span style="color:#f92672">=</span> card; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>TestCard：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestCard</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	String id;
</span></span><span style="display:flex;"><span>	String cardNumber;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCardNumber</span>() { <span style="color:#66d9ef">return</span> cardNumber; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCardNumber</span>(String cardNumber) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cardNumber</span> <span style="color:#f92672">=</span> cardNumber; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样子就是OneToOne了。这个是单向的关系，即：由TestCard控制TestUser。看sql语句就知道了。</p>
<h3 id="db-5">
  DB
  <a class="anchor" href="#db-5">#</a>
</h3>
<p>hibernate自动生成的sql为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_card <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_card (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	card_number varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_user (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	username varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	card_id varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FKB9A96B58A237D846 <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (card_id) <span style="color:#66d9ef">references</span> test_card;
</span></span></code></pre></div><p>个人认为，应该这样子理解OneToOne。</p>
<ol>
<li>首先，他是用来声明在方法上的。（这句好似废话）</li>
<li>然后，他其实是用来annation这个方法的返回值的。即：描述TestCard的。
<blockquote>
<p>也就是说：TestCard 为控制方。TestUser为被控方。那么对应的表中，test_user表有一个外键字段对应着test_card表中的一个主键。</p></blockquote>
</li>
</ol>
<p>这样，就好理解了。</p>
<p>上面的为单向关联。那么，双向关联呢？修改TestCard如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.OneToOne;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestCard</span> {
</span></span><span style="display:flex;"><span>	String   id;
</span></span><span style="display:flex;"><span>	String   cardNumber;
</span></span><span style="display:flex;"><span>	TestUser user;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@OneToOne</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> TestUser <span style="color:#a6e22e">getUser</span>() { <span style="color:#66d9ef">return</span> user; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUser</span>(TestUser user) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> user; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCardNumber</span>() { <span style="color:#66d9ef">return</span> cardNumber; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCardNumber</span>(String cardNumber) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cardNumber</span> <span style="color:#f92672">=</span> cardNumber; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这样，产生的sql为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_card <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_card (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	card_number varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	user_id varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_user (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	username varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	card_id varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_card <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FKB9A0FA9D7876DA66 <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (user_id) <span style="color:#66d9ef">references</span> test_user;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FKB9A96B58A237D846 <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (card_id) <span style="color:#66d9ef">references</span> test_card;
</span></span></code></pre></div><p>可以看到，当我双方都声明了OneToOne时候，也就达到了双向的One2One效果。但是很遗憾。Hibernate不知道你由哪边控制哪边，或者说由哪边来维护关系。所以，他生成的sql语句中可以看到，都有test_card和test_user是相互关联的，即：都有FK关联上堆放的PK。很明显，这个不是我们要的效果。</p>
<p>我们需要的是，pojo中能双向one2one，但是db中不需要。所以，我们需要修改一下。</p>
<p>修改TestCard.java代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.OneToOne;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestCard</span> {
</span></span><span style="display:flex;"><span>	String   id;
</span></span><span style="display:flex;"><span>	String   cardNumber;
</span></span><span style="display:flex;"><span>	TestUser user;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@OneToOne</span>(mappedBy<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;card&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> TestUser <span style="color:#a6e22e">getUser</span>() { <span style="color:#66d9ef">return</span> user; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUser</span>(TestUser user) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> user; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCardNumber</span>() { <span style="color:#66d9ef">return</span> cardNumber; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCardNumber</span>(String cardNumber) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cardNumber</span> <span style="color:#f92672">=</span> cardNumber; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>注意：</strong> OneToOne中的mappedBy就指出了此处返回的TestUser对应的test_user表中有一个指向TestUser的属性&quot;card&quot;的外键。可以看sql。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_card <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_card (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	card_number varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_user (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	username varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	card_id varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_user <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FKB9A96B58A237D846 <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (card_id) <span style="color:#66d9ef">references</span> test_card;
</span></span></code></pre></div><p>而这得&quot;mappedBy=card&quot;中的card是TestUser中的TestCard类型的成员变量名。这也就是为什么我要用Test修饰类名，而对象名却不用的理由。</p>
<p>或者，还可以这样子来理解OneToOne。</p>
<p>1.单向OneToOne中。声明了OneToOne这个Annotation的方法，他的返回值即：维护方。(主键方)
1.双向OneToOne中。在OneToOne中声明了mappedBy=&ldquo;xx&quot;的，他的返回值即：被维护方。(外键方)</p>
<h2 id="annotation的关系映射-1n">
  annotation的关系映射 1:n
  <a class="anchor" href="#annotation%e7%9a%84%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-1n">#</a>
</h2>
<p>这次说说OneToMany和ManyToOne</p>
<p>我们的场景是 1个父亲n多个孩子</p>
<h3 id="pojo-6">
  Pojo
  <a class="anchor" href="#pojo-6">#</a>
</h3>
<p>先来看看这中做法：</p>
<p>TestFather.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.OneToMany;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestFather</span>{
</span></span><span style="display:flex;"><span>	String          id;
</span></span><span style="display:flex;"><span>	String          name;
</span></span><span style="display:flex;"><span>	List children <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@OneToMany</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> List <span style="color:#a6e22e">getChildren</span>() { <span style="color:#66d9ef">return</span> children; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setChildren</span>(List children) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">children</span> <span style="color:#f92672">=</span> children; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>TestChild.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestChild</span> {
</span></span><span style="display:flex;"><span>	String     id;
</span></span><span style="display:flex;"><span>	String     name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="db-6">
  DB
  <a class="anchor" href="#db-6">#</a>
</h3>
<p>这样子，好像就可以了。那么是的么？我们来看看hib产生的sql</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_child <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_father <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_father_children <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_child (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	name varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_father (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	name varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_father_children (
</span></span><span style="display:flex;"><span>	null_id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	children_id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">unique</span> (children_id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_father_children 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FK2E6E87D5901B7DBB 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (null_id) 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">references</span> test_father;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_father_children 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FK2E6E87D58CD0E56B 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (children_id) 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">references</span> test_child;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> test_user 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> FKB9A96B58A237D846 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (card_id) 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">references</span> test_card;
</span></span></code></pre></div><p>oh！ My God ！它居然又帮我们多创建了一个table。作为关联。太笨了。</p>
<p>很明显，这不是我们所需要的。</p>
<p>那我们该如何呢？这就需要ManyToMany了。</p>
<h2 id="annotation的关系映射-nn">
  annotation的关系映射 n:n
  <a class="anchor" href="#annotation%e7%9a%84%e5%85%b3%e7%b3%bb%e6%98%a0%e5%b0%84-nn">#</a>
</h2>
<p>场景：Product和Customer。</p>
<h3 id="pojo-7">
  Pojo
  <a class="anchor" href="#pojo-7">#</a>
</h3>
<p>先看TestProduct.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.ManyToMany;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestProduct</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String             id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String             name;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">float</span>              price;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> List customers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> name; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span>(String name) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">float</span> <span style="color:#a6e22e">getPrice</span>() { <span style="color:#66d9ef">return</span> price; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setPrice</span>(<span style="color:#66d9ef">float</span> price) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">price</span> <span style="color:#f92672">=</span> price; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@ManyToMany</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> List <span style="color:#a6e22e">getCustomers</span>() { <span style="color:#66d9ef">return</span> customers; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCustomers</span>(List customers) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">customers</span> <span style="color:#f92672">=</span> customers; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>注意这里的ManyToMany什么都没有写。</p>
<p>再看TestCustomer.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Entity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.Id;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.persistence.ManyToMany;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestCustomer</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String            id;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> String            tel;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> List products <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> id; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span>(String id) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getTel</span>() { <span style="color:#66d9ef">return</span> tel; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setTel</span>(String tel) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tel</span> <span style="color:#f92672">=</span> tel; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@ManyToMany</span>(mappedBy <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;customers&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> List <span style="color:#a6e22e">getProducts</span>() { <span style="color:#66d9ef">return</span> products; }
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setProducts</span>(List products) { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">products</span> <span style="color:#f92672">=</span> products; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>**注意：**这里的ManyToMany我写了mappedBy这个attribute。</p>
<h3 id="db-7">
  DB
  <a class="anchor" href="#db-7">#</a>
</h3>
<p>然后看hib产生的sql:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_customer <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_product <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> test_product_customers <span style="color:#66d9ef">cascade</span> <span style="color:#66d9ef">constraints</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_customer (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	tel varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_product (
</span></span><span style="display:flex;"><span>	id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	price float <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	name varchar2(<span style="color:#ae81ff">255</span> char),
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> (id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> test_product_customers (
</span></span><span style="display:flex;"><span>	products_id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
</span></span><span style="display:flex;"><span>	customers_id varchar2(<span style="color:#ae81ff">255</span> char) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>ok! 非常好。hib终于在ManyToMany上没有犯白痴了。</p>
<p>上面强调了mappedBy这个属性。其实，之前有提到mappedBy这个东西。只是，我没有说到底是什么意思。其实很简单：这个东西就相当于xml配置中的inverse。写了mappedBy就代表这个方法的返回值是被维护方。</p></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/RyanPoy/blog/commit/bef9898b06267e5ae0fb1fd795767908bf07b3c1" title='Last modified by pengyi | July 16, 2025' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>July 16, 2025</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/RyanPoy/blog/edit/main/exampleSite/content/posts/hibernate%20simple%20tutorials.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#初次使用">初次使用</a>
          <ul>
            <li><a href="#pojo">Pojo</a></li>
            <li><a href="#db">DB</a></li>
            <li><a href="#hibernatecfgxml">hibernate.cfg.xml</a></li>
            <li><a href="#userhbmxml">User.hbm.xml</a></li>
            <li><a href="#testing">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-11">xml关系映射 1:1</a>
          <ul>
            <li><a href="#db-1">DB</a></li>
            <li><a href="#pojo-1">Pojo</a></li>
            <li><a href="#mapping-xml">Mapping Xml</a></li>
            <li><a href="#testing-1">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-1n">xml关系映射 1:n</a>
          <ul>
            <li><a href="#db-2">DB</a></li>
            <li><a href="#pojo-2">Pojo</a></li>
            <li><a href="#mapping-xml-1">Mapping Xml</a></li>
            <li><a href="#testing-2">Testing</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射-nn">xml关系映射 n:n</a>
          <ul>
            <li><a href="#db-3">DB</a></li>
            <li><a href="#pojo-3">Pojo</a></li>
            <li><a href="#mapping-xml-2">Mapping Xml</a></li>
          </ul>
        </li>
        <li><a href="#xml关系映射---复杂的case">xml关系映射 - 复杂的case</a>
          <ul>
            <li><a href="#db-4">DB</a></li>
            <li><a href="#pojo-4">Pojo</a></li>
            <li><a href="#mapping-xml-3">Mapping Xml</a></li>
            <li><a href="#testing-3">Testing</a></li>
          </ul>
        </li>
        <li><a href="#annotation关系映射-11">annotation关系映射 1:1</a>
          <ul>
            <li><a href="#pojo-5">Pojo</a></li>
            <li><a href="#db-5">DB</a></li>
          </ul>
        </li>
        <li><a href="#annotation的关系映射-1n">annotation的关系映射 1:n</a>
          <ul>
            <li><a href="#pojo-6">Pojo</a></li>
            <li><a href="#db-6">DB</a></li>
          </ul>
        </li>
        <li><a href="#annotation的关系映射-nn">annotation的关系映射 n:n</a>
          <ul>
            <li><a href="#pojo-7">Pojo</a></li>
            <li><a href="#db-7">DB</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












