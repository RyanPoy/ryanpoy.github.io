<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="rails中，有一个active_validation，用来做一些常见的校验，十分方便。于是乎，模仿了它，写下了它。
#coding: utf-8
import re

class NoOptionError(Exception):
    def __init__(self, options = []):
        self.msg = &#39;should be in [%s], but noting&#39; % &#39;, &#39;.join(options)
        

class OptionNameError(Exception):
    def __init__(self, option, options = []):
        should_be = &#39;, &#39;.join(options)
        self.msg = &#39;should be in [%s], but %s&#39; % (should_be, option)


class Validator(object):
    
    def _validate_options(self, **options):
        all_null = True
        for opt in options:
            if opt not in self._options:
                raise OptionNameError(opt, self._options)
            else:
                if options[opt] is not None:
                    all_null = False
        if all_null:
            raise NoOptionError(self._options)
        return True
    
    
class PresenceValidator(Validator):
    
    def validate(self, value, allow_blank = True):
        if value is None:
            return False
        
        if allow_blank:
            if isinstance(value, str): # 字符串要单独处理
                if not value.strip():
                    return True
            if not value:
                return True
        else:
            if isinstance(value, str): # 字符串要单独处理
                if not value.strip():
                    return False
            if (isinstance(value, str) or isinstance(value, list) 
                or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断
                return False
            
        return True
    
    
class InclusionValidator(Validator):
    
    def validate(self, value, in_values = [], allow_null = False, allow_blank = False):
        if value is None:
            return allow_null
            
        if isinstance(value, str):
            value = value.strip()
            
        if isinstance(value, str) and not value:
            return allow_blank
        return value in in_values


class NumericalityValidator(Validator):
    _options = set([
        &#39;greater_than&#39;, &#39;greater_than_or_equal_to&#39;, &#39;equal_to&#39;, 
        &#39;less_than&#39;, &#39;less_than_or_equal_to&#39;, &#39;odd&#39;, &#39;even&#39;
    ])
    
    def validate(self, value, **options):
        self._validate_options(**options)
        if value is None:
            raise Exception(&#39;value can not be null.&#39;)
        if type(value) not in (int, long, float):
            raise Exception(&#39;value should be a number, but a %s&#39; % type(value))
        if options.get(&#39;greater_than&#39;, False) and value &lt;= options[&#39;greater_than&#39;]: 
            return False
        if options.get(&#39;greater_than_or_equal_to&#39;, False) and value &lt; options[&#39;greater_than_or_equal_to&#39;]:
            return False
        if options.get(&#39;equal_to&#39;, False) and value != options[&#39;equal_to&#39;]:
            return False
        if options.get(&#39;less_than&#39;, False) and value &gt;= options[&#39;less_than&#39;]:
            return False
        if options.get(&#39;less_than_or_equal_to&#39;, False) and value &gt; options[&#39;less_than_or_equal_to&#39;]:
            return False
        odd = options.get(&#39;odd&#39;, None)
        if odd in (True, False):
            if odd:
                if value % 2 == 0: return False
            else:
                if value % 2 != 0: return False
        even = options.get(&#39;even&#39;, None)
        if even in (True, False):
            if even:
                if value % 2 != 0: return False
            else:
                if value % 2 == 0: return False
        return True
        

class AcceptanceValidator(Validator):
    
    def validate(self, value, allow_null = True ):
        if allow_null:
            return True
        return value is not None
    
    
class LengthValidator(Validator):
    _options = set([
        &#39;_is&#39;, &#39;minimum&#39;, &#39;maximum&#39;, 
        &#39;allow_null&#39;, &#39;allow_blank&#39;
    ])
    
    def validate(self, value, **options):
        self._validate_options(**options)
        if value is None:
            return options.get(&#39;allow_null&#39;, True)
        
        if options.get(&#39;allow_blank&#39;, True):
            if isinstance(value, str):
                if value.strip() == &#39;&#39;:
                    return True
            if not value:
                return True
        else:
            if isinstance(value, str):
                if value.strip() == &#39;&#39;:
                    return False
            if (isinstance(value, str) or isinstance(value, list) 
                or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断
                return False
            
        if options.get(&#39;_is&#39;, False) and len(value) != options[&#39;_is&#39;]: 
            return False
        if options.get(&#39;minimum&#39;, False) and len(value) &lt; options[&#39;minimum&#39;]:
            return False
        if options.get(&#39;maximum&#39;, False) and len(value) &gt; options[&#39;maximum&#39;]:
            return False
        return True


class ConfirmationValidator(Validator):
    
    def validate(self, value, confirmation_value):
        return confirmation_value == value


class FormatValidator(Validator):
    
    def validate(self, value, _with = None, allow_null = True, allow_blank = True):
        if value is None:
            return allow_null
        
        if allow_blank:
            if isinstance(value, str):
                if not value.strip():
                    return True
            if (isinstance(value, str) or isinstance(value, list) 
                or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断
                return True
        
        return True if re.match(_with, value) else False

    
class ExclusionValidator(Validator):
    
    def validate(self, value, exclusion_values = [], allow_null = False, allow_blank = False):
        if value is None:
            return allow_null
            
        if isinstance(value, str):
            value = value.strip()
            
        if (isinstance(value, str) or isinstance(value, list) 
                or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断
            return allow_blank
        
        return value not in exclusion_values
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="/posts/python-validation/">
  <meta property="og:site_name" content="一哥黑板报">
  <meta property="og:title" content="python validation">
  <meta property="og:description" content="rails中，有一个active_validation，用来做一些常见的校验，十分方便。于是乎，模仿了它，写下了它。
#coding: utf-8 import re class NoOptionError(Exception): def __init__(self, options = []): self.msg = &#39;should be in [%s], but noting&#39; % &#39;, &#39;.join(options) class OptionNameError(Exception): def __init__(self, option, options = []): should_be = &#39;, &#39;.join(options) self.msg = &#39;should be in [%s], but %s&#39; % (should_be, option) class Validator(object): def _validate_options(self, **options): all_null = True for opt in options: if opt not in self._options: raise OptionNameError(opt, self._options) else: if options[opt] is not None: all_null = False if all_null: raise NoOptionError(self._options) return True class PresenceValidator(Validator): def validate(self, value, allow_blank = True): if value is None: return False if allow_blank: if isinstance(value, str): # 字符串要单独处理 if not value.strip(): return True if not value: return True else: if isinstance(value, str): # 字符串要单独处理 if not value.strip(): return False if (isinstance(value, str) or isinstance(value, list) or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断 return False return True class InclusionValidator(Validator): def validate(self, value, in_values = [], allow_null = False, allow_blank = False): if value is None: return allow_null if isinstance(value, str): value = value.strip() if isinstance(value, str) and not value: return allow_blank return value in in_values class NumericalityValidator(Validator): _options = set([ &#39;greater_than&#39;, &#39;greater_than_or_equal_to&#39;, &#39;equal_to&#39;, &#39;less_than&#39;, &#39;less_than_or_equal_to&#39;, &#39;odd&#39;, &#39;even&#39; ]) def validate(self, value, **options): self._validate_options(**options) if value is None: raise Exception(&#39;value can not be null.&#39;) if type(value) not in (int, long, float): raise Exception(&#39;value should be a number, but a %s&#39; % type(value)) if options.get(&#39;greater_than&#39;, False) and value &lt;= options[&#39;greater_than&#39;]: return False if options.get(&#39;greater_than_or_equal_to&#39;, False) and value &lt; options[&#39;greater_than_or_equal_to&#39;]: return False if options.get(&#39;equal_to&#39;, False) and value != options[&#39;equal_to&#39;]: return False if options.get(&#39;less_than&#39;, False) and value &gt;= options[&#39;less_than&#39;]: return False if options.get(&#39;less_than_or_equal_to&#39;, False) and value &gt; options[&#39;less_than_or_equal_to&#39;]: return False odd = options.get(&#39;odd&#39;, None) if odd in (True, False): if odd: if value % 2 == 0: return False else: if value % 2 != 0: return False even = options.get(&#39;even&#39;, None) if even in (True, False): if even: if value % 2 != 0: return False else: if value % 2 == 0: return False return True class AcceptanceValidator(Validator): def validate(self, value, allow_null = True ): if allow_null: return True return value is not None class LengthValidator(Validator): _options = set([ &#39;_is&#39;, &#39;minimum&#39;, &#39;maximum&#39;, &#39;allow_null&#39;, &#39;allow_blank&#39; ]) def validate(self, value, **options): self._validate_options(**options) if value is None: return options.get(&#39;allow_null&#39;, True) if options.get(&#39;allow_blank&#39;, True): if isinstance(value, str): if value.strip() == &#39;&#39;: return True if not value: return True else: if isinstance(value, str): if value.strip() == &#39;&#39;: return False if (isinstance(value, str) or isinstance(value, list) or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断 return False if options.get(&#39;_is&#39;, False) and len(value) != options[&#39;_is&#39;]: return False if options.get(&#39;minimum&#39;, False) and len(value) &lt; options[&#39;minimum&#39;]: return False if options.get(&#39;maximum&#39;, False) and len(value) &gt; options[&#39;maximum&#39;]: return False return True class ConfirmationValidator(Validator): def validate(self, value, confirmation_value): return confirmation_value == value class FormatValidator(Validator): def validate(self, value, _with = None, allow_null = True, allow_blank = True): if value is None: return allow_null if allow_blank: if isinstance(value, str): if not value.strip(): return True if (isinstance(value, str) or isinstance(value, list) or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断 return True return True if re.match(_with, value) else False class ExclusionValidator(Validator): def validate(self, value, exclusion_values = [], allow_null = False, allow_blank = False): if value is None: return allow_null if isinstance(value, str): value = value.strip() if (isinstance(value, str) or isinstance(value, list) or isinstance(value, dict) or isinstance(value, tuple)) and not value: # 数字0不用做这个判断 return allow_blank return value not in exclusion_values">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2010-11-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-07-17T10:11:18+08:00">
    <meta property="article:tag" content="Python">
<title>python validation | 一哥黑板报</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="/posts/python-validation/">
<link rel="stylesheet" href="/book.min.e47103a2785905b5db8438d6a609c05371af6c90eabdc369de60b296f8bba830.css" >
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.1b54163ba33699d30ae95ade6aca3c1aab77db8407ee0eb2bed501765f3a8acb.js" ></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.jpeg" alt="Logo" class="book-icon" /><span>一哥黑板报</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>























  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/RyanPoy/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>python validation</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents"></nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    python validation
  </h1>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/svg/calendar.svg" class="book-icon " alt="" />
    <span>November 13, 2010</span>
  </div>



  
  <div class="text-small">
    
      <a href="/categories/Tech/">Tech</a>
  </div>
  

  
  <div class="text-small">
    
      <a href="/tags/Python/">Python</a>
  </div>
  


  <div class="book-post-content"><p>rails中，有一个active_validation，用来做一些常见的校验，十分方便。于是乎，模仿了它，写下了它。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#coding: utf-8</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NoOptionError</span>(<span style="color:#a6e22e">Exception</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, options <span style="color:#f92672">=</span> []):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>msg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;should be in [</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">], but noting&#39;</span> <span style="color:#f92672">%</span> <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(options)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OptionNameError</span>(<span style="color:#a6e22e">Exception</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, option, options <span style="color:#f92672">=</span> []):
</span></span><span style="display:flex;"><span>        should_be <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(options)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>msg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;should be in [</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">], but </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (should_be, option)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Validator</span>(object):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_validate_options</span>(self, <span style="color:#f92672">**</span>options):
</span></span><span style="display:flex;"><span>        all_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> opt <span style="color:#f92672">in</span> options:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> opt <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>_options:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> OptionNameError(opt, self<span style="color:#f92672">.</span>_options)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> options[opt] <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                    all_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> all_null:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> NoOptionError(self<span style="color:#f92672">.</span>_options)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PresenceValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, allow_blank <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> allow_blank:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(value, str): <span style="color:#75715e"># 字符串要单独处理</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value<span style="color:#f92672">.</span>strip():
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(value, str): <span style="color:#75715e"># 字符串要单独处理</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value<span style="color:#f92672">.</span>strip():
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (isinstance(value, str) <span style="color:#f92672">or</span> isinstance(value, list) 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">or</span> isinstance(value, dict) <span style="color:#f92672">or</span> isinstance(value, tuple)) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> value: <span style="color:#75715e"># 数字0不用做这个判断</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InclusionValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, in_values <span style="color:#f92672">=</span> [], allow_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>, allow_blank <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> allow_null
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(value, str):
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> value<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(value, str) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> value:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> allow_blank
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value <span style="color:#f92672">in</span> in_values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NumericalityValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    _options <span style="color:#f92672">=</span> set([
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;greater_than&#39;</span>, <span style="color:#e6db74">&#39;greater_than_or_equal_to&#39;</span>, <span style="color:#e6db74">&#39;equal_to&#39;</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;less_than&#39;</span>, <span style="color:#e6db74">&#39;less_than_or_equal_to&#39;</span>, <span style="color:#e6db74">&#39;odd&#39;</span>, <span style="color:#e6db74">&#39;even&#39;</span>
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, <span style="color:#f92672">**</span>options):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_validate_options(<span style="color:#f92672">**</span>options)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#39;value can not be null.&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> type(value) <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> (int, long, float):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#39;value should be a number, but a </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> type(value))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;greater_than&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> value <span style="color:#f92672">&lt;=</span> options[<span style="color:#e6db74">&#39;greater_than&#39;</span>]: 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;greater_than_or_equal_to&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> value <span style="color:#f92672">&lt;</span> options[<span style="color:#e6db74">&#39;greater_than_or_equal_to&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;equal_to&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> value <span style="color:#f92672">!=</span> options[<span style="color:#e6db74">&#39;equal_to&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;less_than&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> value <span style="color:#f92672">&gt;=</span> options[<span style="color:#e6db74">&#39;less_than&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;less_than_or_equal_to&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> value <span style="color:#f92672">&gt;</span> options[<span style="color:#e6db74">&#39;less_than_or_equal_to&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        odd <span style="color:#f92672">=</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;odd&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> odd <span style="color:#f92672">in</span> (<span style="color:#66d9ef">True</span>, <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> odd:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        even <span style="color:#f92672">=</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;even&#39;</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> even <span style="color:#f92672">in</span> (<span style="color:#66d9ef">True</span>, <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> even:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AcceptanceValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, allow_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span> ):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> allow_null:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LengthValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    _options <span style="color:#f92672">=</span> set([
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;_is&#39;</span>, <span style="color:#e6db74">&#39;minimum&#39;</span>, <span style="color:#e6db74">&#39;maximum&#39;</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;allow_null&#39;</span>, <span style="color:#e6db74">&#39;allow_blank&#39;</span>
</span></span><span style="display:flex;"><span>    ])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, <span style="color:#f92672">**</span>options):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_validate_options(<span style="color:#f92672">**</span>options)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;allow_null&#39;</span>, <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;allow_blank&#39;</span>, <span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(value, str):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value<span style="color:#f92672">.</span>strip() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(value, str):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> value<span style="color:#f92672">.</span>strip() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (isinstance(value, str) <span style="color:#f92672">or</span> isinstance(value, list) 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">or</span> isinstance(value, dict) <span style="color:#f92672">or</span> isinstance(value, tuple)) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> value: <span style="color:#75715e"># 数字0不用做这个判断</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;_is&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> len(value) <span style="color:#f92672">!=</span> options[<span style="color:#e6db74">&#39;_is&#39;</span>]: 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;minimum&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> len(value) <span style="color:#f92672">&lt;</span> options[<span style="color:#e6db74">&#39;minimum&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> options<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;maximum&#39;</span>, <span style="color:#66d9ef">False</span>) <span style="color:#f92672">and</span> len(value) <span style="color:#f92672">&gt;</span> options[<span style="color:#e6db74">&#39;maximum&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConfirmationValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, confirmation_value):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> confirmation_value <span style="color:#f92672">==</span> value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FormatValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, _with <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>, allow_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>, allow_blank <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> allow_null
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> allow_blank:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isinstance(value, str):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value<span style="color:#f92672">.</span>strip():
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (isinstance(value, str) <span style="color:#f92672">or</span> isinstance(value, list) 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">or</span> isinstance(value, dict) <span style="color:#f92672">or</span> isinstance(value, tuple)) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> value: <span style="color:#75715e"># 数字0不用做这个判断</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span> <span style="color:#66d9ef">if</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(_with, value) <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExclusionValidator</span>(Validator):
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(self, value, exclusion_values <span style="color:#f92672">=</span> [], allow_null <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>, allow_blank <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> value <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> allow_null
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(value, str):
</span></span><span style="display:flex;"><span>            value <span style="color:#f92672">=</span> value<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (isinstance(value, str) <span style="color:#f92672">or</span> isinstance(value, list) 
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">or</span> isinstance(value, dict) <span style="color:#f92672">or</span> isinstance(value, tuple)) <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> value: <span style="color:#75715e"># 数字0不用做这个判断</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> allow_blank
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> value <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> exclusion_values
</span></span></code></pre></div></div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/RyanPoy/blog/commit/8e95d884fec2558fa35de60797e1213bb68305ec" title='Last modified by pengyi | July 17, 2025' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>July 17, 2025</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents"></nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












